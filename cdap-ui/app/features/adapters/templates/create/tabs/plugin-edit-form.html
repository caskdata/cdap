<!--
  TODO: This file has to be split.
  It right now has these cases:
    1. Has property
      - Has configuration from node proxy
        - If its source - Don't show input schema
        - If its source have it as two columns 7 and 5
        - If its transform have three columns 2, 5 & 5
        - If its sink have two columns with 2nd column having nested row.
          2, 10 (with a row and col-xs-12 under 2nd column)
      - Doesn't have configuration from node proxy
        - Just show everything as text boxes.
    2. Has no property
      - Show a message saying there is are no property for this plugin
  On top of all this we are showing a loading icon (with forced 1s delay) to have modal animation smooth.

   I wish I was vandame.
-->
<div ng-controller="PluginEditController as PluginEditController">
  <div class="modal-header">
    <div ng-class="{ 'col-xs-6 col-md-9': !isDisabled, 'col-xs-10 col-md-11': isDisabled }">
      <h3 class="modal-title">{{plugin.name | caskCapitalizeFilter}} Properties</h3>
      <p>{{plugin.description | caskCapitalizeFilter}}</p>
    </div>
    <div ng-class="{ 'col-xs-6 col-md-3': !isDisabled, 'col-xs-2 col-md-1': isDisabled }">
      <div class="btn-group modal-btns">
        <div ng-if="!isDisabled">
          <a class="btn" ng-click="PluginEditController.reset()">
            <span class="fa fa-repeat"></span>
          </a>
        </div>
        <div ng-if="!isDisabled">
          <a class="btn" ng-click="$close('save')">
            <span class="fa fa-floppy-o"></span>
          </a>
        </div>
        <div ng-if="!isDisabled">
          <a class="btn" ng-click="$close('cancel')">
            <span class="fa fa-remove"></span>
            <span class="sr-only"> Close </span>
          </a>
        </div>

        <!-- Only shows the close button on already created adapter -->
        <div ng-if="isDisabled">
          <a class="btn" ng-click="$close()">
            <span class="fa fa-remove"></span>
            <span class="sr-only">Close</span>
          </a>
        </div>

      </div>
    </div>
  </div>

  <div class="modal-body plugin-modal" ng-class="{'modal-source': plugin.type === 'source', 'modal-transform': plugin.type === 'transform', 'modal-sink': plugin.type === 'sink'}">
    <div ng-if="PluginEditController.noproperty !== 0">
    <div class="row" ng-if="(PluginEditController.configfetched && !PluginEditController.noconfig)">

      <!-- INPUT SCHEMA -->
      <div class="col-lg-3" ng-if="!isSource">
        <div class="input-schema modal-content-scroll">
            <div class="schema-inner" ng-if="inputSchema">
              <h4>Input Schema</h4>
              <table class="table">
                <thead>
                  <th>
                    <label class="control-label">Name</label>
                  </th>
                  <th>
                    <label class="control-label">Type</label>
                  </th>
                </thead>
                <tbody>
                  <tr ng-repeat="schema in inputSchema" ng-keypress="enter($event, $last)">
                    <td class="name" ng-if="!schema.empty">
                      <span tooltip="{{ schema.name }}"
                            tooltip-ellipsis="{{ schema.name }}"
                            data-ellipsis="isEllipsis"
                            tooltip-enable="isEllipsis"
                            tooltip-append-to-body="true">
                        {{schema.name}}
                      </span>
                    </td>
                    <td class="type" ng-if="!schema.empty"> {{schema.type}} </td>

                    <td class="name" ng-if="property.empty"></td>
                    <td class="type" ng-if="property.empty"></td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="empty-container" ng-if="!inputSchema">
              <h4>Input Schema</h4>
              <p>There is no input schema</p>
            </div>
        </div>
      </div>

      <!-- MAIN WIDGET -->
      <div ng-class="{'col-lg-8': isSource, 'col-lg-5': isTransform }" ng-if="!isSink">
        <div class="modal-content-scroll" ng-class="{'padding-offset-right': isSource, 'padding-offset-left': isTransform}">
          <form plugin-property-edit-view>
            <fieldset ng-disabled="isDisabled">

              <div ng-if="PluginEditController.configfetched">

                <div ng-repeat="group in PluginEditController.config.groups.position">
                  <div class="widget-group-container">
                    <h4>{{PluginEditController.groups[group].display}}</h4>
                    <div ng-repeat="field in PluginEditController.groups[group].position">
                      <div ng-if="field !== 'schema'">
                        <div class="form-group">
                          <label class="control-label"
                                  ng-init="title=PluginEditController.groups[group].fields[field].info;description=PluginEditController.groups[group].fields[field].description">
                            <span>{{PluginEditController.groups[group].fields[field].label}}</span>
                            <span class="fa fa-info-circle"
                                  tooltip="{{description}}"
                                  tooltip-placement="right"
                                  tooltip-append-to-body="true">
                            </span>
                            <span class="fa fa-asterisk" ng-if="plugin._backendProperties[name].required"></span>
                          </label>
                          <div>
                            <div data-name="field"
                                 class="my-widget-container"
                                 data-model="plugin.properties[field]"
                                 data-myconfig="PluginEditController.groups[group].fields[field]"
                                 data-properties="plugin.properties"
                                 widget-container>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            </fieldset>

          </form>
        </div>
      </div>

      <!-- OUTPUT EDITOR -->
      <div class="col-lg-4" ng-if="!isSink">
        <div class="modal-content-scroll output-schema">
          <h4>Output Schema</h4>

          <fieldset ng-disabled="isDisabled" ng-if="plugin.outputSchema || !isDisabled">
            <my-schema-editor
              ng-model="plugin.outputSchema"
              data-disabled="plugin.implicitSchema"
              ng-if="plugin.name !== 'Stream' && plugin.name !== 'Kafka'"></my-schema-editor>
            <my-stream-properties
              ng-model="plugin.outputSchema"
              plugins="plugin.properties"
              ng-if="plugin.name === 'Stream' || plugin.name === 'Kafka'"
            ></my-stream-properties>
          </fieldset>

          <div ng-if="!plugin.outputSchema && isDisabled">
            <div class="well well-lg">
              <h4>There is no output schema</h4>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-9" ng-if="isSink">
        <div class="modal-content-scroll">

          <div class="row">
            <div class="col-xs-12">
              <div class="padding-offset-left">
                <form plugin-property-edit-view>
                  <fieldset ng-disabled="isDisabled">
                    <div ng-if="PluginEditController.noconfig">
                      <div class="well well-lg widget-group-container">
                        <div ng-repeat="(name, value) in plugin.properties track by $index">
                          <div class="form-group">
                            <label ng-init="title='info';description=plugin._backendProperties[name].description"
                                    class="control-label">
                              <span>{{name}}</span>
                              <span class="fa fa-info-circle"
                                    tooltip="{{description}}"
                                    tooltip-placement="right"
                                    tooltip-append-to-body="true">
                              </span>
                              <span class="fa fa-asterisk" ng-if="plugin._backendProperties[name].required"></span>
                            </label>
                            <input type="text"
                                    class="form-control"
                                    ng-model="plugin.properties[name]" />
                          </div>
                        </div>
                      </div>
                    </div>

                    <div ng-if="PluginEditController.configfetched">

                      <div ng-repeat="group in PluginEditController.config.groups.position">
                        <div class="widget-group-container">
                          <h4>{{PluginEditController.groups[group].display}}</h4>
                          <div ng-repeat="field in PluginEditController.groups[group].position">
                            <div ng-if="field !== 'schema'">
                              <div class="form-group">
                                <label class="control-label"
                                        ng-init="title=PluginEditController.groups[group].fields[field].info;description=PluginEditController.groups[group].fields[field].description">
                                  <span>{{PluginEditController.groups[group].fields[field].label}}</span>
                                  <span class="fa fa-info-circle"
                                        tooltip="{{description}}"
                                        tooltip-placement="right"
                                        tooltip-append-to-body="true">
                                  </span>
                                  <span class="fa fa-asterisk" ng-if="plugin._backendProperties[name].required"></span>
                                </label>
                                <div>
                                  <div data-name="field"
                                       class="my-widget-container"
                                       data-model="plugin.properties[field]"
                                       data-myconfig="PluginEditController.groups[group].fields[field]"
                                       data-properties="plugin.properties"
                                       widget-container>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                    </div>
                  </fieldset>

                  <div ng-if="!PluginEditController.noproperty">
                    <h4>{{plugin.name | caskCapitalizeFilter}}</h4>
                    <div class="well well-lg">
                      <p>No Properties for this Plugin.</p>
                    </div>
                  </div>
                </form>
              </div>
            </div>

            <div class="col-xs-12">
              <div class="padding-offset-right padding-offset-left">

                <h4>Schema</h4>

                <fieldset ng-disabled="isDisabled">
                  <my-schema-editor
                    ng-model="plugin.outputSchema"
                    data-disabled="plugin.implicitSchema" ng-if="plugin.name !== 'Stream' && plugin.name !== 'Kafka'"></my-schema-editor>
                  <my-stream-properties
                    ng-model="plugin.outputSchema"
                    plugins="plugin.properties"
                    ng-if="plugin.name === 'Stream' || plugin.name === 'Kafka'"
                  ></my-stream-properties>
                </fieldset>

                <div ng-if="!plugin.outputSchema && isDisabled">
                  <div class="well well-lg">
                    <h4>There is no output schema</h4>
                  </div>
                </div>

              </div>
            </div>
          </div>

        </div>
      </div>

    </div>
    <div class="row" ng-if="PluginEditController.noconfig">
      <div class="col-xs-12">
        <div class="modal-content-scroll" ng-class="{'padding-offset-right': isSource, 'padding-offset-left': isTransform}">
          <fieldset ng-disabled="isDisabled">
            <div ng-if="PluginEditController.noconfig">
              <div class="well well-lg widget-group-container">
                <div ng-repeat="(name, value) in plugin.properties track by $index">
                  <div class="form-group">
                    <label ng-init="title='info';description=plugin._backendProperties[name].description"
                            class="control-label">
                      <span>{{name}}</span>
                      <span class="fa fa-info-circle"
                            tooltip="{{description}}"
                            tooltip-placement="right"
                            tooltip-append-to-body="true">
                      </span>
                      <span class="fa fa-asterisk" ng-if="plugin._backendProperties[name].required"></span>
                    </label>
                    <input type="text"
                            class="form-control"
                            ng-model="plugin.properties[name]" />
                  </div>
                </div>
              </div>
            </div>
          </fieldset>
        </div>
      </div>
    </div>
    </div>
    <div ng-if="!PluginEditController.configfetched">
      <h3>
        <span class="fa fa-spinner fa-spin"></span>
        <span>Loading...</span>
      </h3>
    </div>

    <div ng-if="PluginEditController.noproperty === 0">
      <div class="modal-content-scroll" ng-class="{'padding-offset-right': isSource, 'padding-offset-left': isTransform}">
        <div class="well well-lg">
          <p>No Properties for this Plugin.</p>
        </div>
      </div>
    </div>
  </div>
</div>
